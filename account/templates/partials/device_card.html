<div id="device-{{ device.id }}"
     class="collapse collapse-arrow bg-base-100 border border-base-300 overflow-visible">
  <input type="checkbox" id="toggle-{{ device.id }}" class="peer" />
  <label for="toggle-{{ device.id }}" class="collapse-title cursor-pointer">
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 flex-wrap">
          <h3 class="font-semibold text-base">{{ device.display_name }}</h3>
          {% if device.trusted %}<div class="badge badge-success badge-sm">Trusted</div>{% endif %}
          {% if device.blocked %}<div class="badge badge-error badge-sm">Blocked</div>{% endif %}
        </div>
        <div class="text-sm text-base-content/60 mt-1">
          <span>{{ device.platform }}</span>
          <span class="mx-1">â€¢</span>
          <span>Last used {{ device.last_seen_at|timesince }} ago</span>
        </div>
        <div class="text-xs text-base-content/50 mt-1">{{ device.access_count }} login{{ device.access_count|pluralize }}</div>
      </div>
      <div class="dropdown dropdown-end" onclick="event.stopPropagation();">
        <label tabindex="0" class="btn btn-ghost btn-sm btn-circle">{% include "icons/menu-dots.html" %}</label>
        <ul tabindex="0"
            class="dropdown-content z-[100] menu p-2 shadow-lg bg-base-100 rounded-box w-52 border border-base-300">
          {% if not device.blocked %}
            <li>
              <button hx-post="{% url 'device_trust' device.id %}"
                      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                      hx-target="#device-list"
                      hx-swap="outerHTML"
                      class="{% if device.trusted %}
                               text-warning
                             {% else %}
                               text-success
                             {% endif %}">
                {% if device.trusted %}
                  {% include "icons/block-x.html" %}
                  Untrust Device
                {% else %}
                  {% include "icons/checkmark-circle.html" %}
                  Trust Device
                {% endif %}
              </button>
            </li>
            <li>
              <a href="{% url 'device_block' device.id %}" class="text-error">
                {% include "icons/block-x.html" %}
                Block Device
              </a>
            </li>
          {% endif %}
          <li>
            <a href="{% url 'device_delete' device.id %}" class="text-warning">
              {% include "icons/trash.html" %}
              Forget Device
            </a>
          </li>
        </ul>
      </div>
    </div>
  </label>
  <div class="collapse-content">
    <div hx-get="{% url 'device_detail' device.id %}"
         hx-trigger="intersect once"
         hx-swap="innerHTML">
      <div class="flex items-center justify-center py-4">
        <span class="loading loading-spinner loading-sm"></span>
      </div>
    </div>
  </div>
</div>
